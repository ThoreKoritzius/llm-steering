module.exports=[7884,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d="28px 'Space Grotesk', sans-serif",e="#1a1a1a";function f(a,b,c){let d={r:247,g:244,b:238};if(c<=b)return{...d,css:`rgb(${d.r},${d.g},${d.b})`};let e=(Math.min(Math.max(a,b),c)-b)/(c-b);if(e<.5){let a=Math.pow((.5-e)/.5,.7),b=Math.round(d.r*(1-a)+42*a),c=Math.round(d.g*(1-a)+97*a),f=Math.round(d.b*(1-a)+216*a);return{r:b,g:c,b:f,css:`rgb(${b},${c},${f})`}}let f=Math.pow((e-.5)/.5,.7),g=Math.round(d.r*(1-f)+217*f),h=Math.round(d.g*(1-f)+67*f),i=Math.round(d.b*(1-f)+58*f);return{r:g,g:h,b:i,css:`rgb(${g},${h},${i})`}}function g(a){return a?a.label?a.label:a.system_prompt?a.system_prompt.replace(/\s+/g," ").trim():"System prompt":"System prompt"}function h({row:a,data:g,vmin:h,vmax:i,options:j={}}){let k=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let b=k.current;if(!b)return;let c=b.getContext("2d");if(!c)return;let l=b.width,m=b.height;c.clearRect(0,0,l,m),c.fillStyle="#ffffff",c.fillRect(0,0,l,m),c.textBaseline="top";let n=l-70,o=Number(a.coeff??0).toFixed(0),p=j.layer??g?.layer??"",q=j.prompt??g?.prompt??"",r=j.maxTokens??g?.max_new_tokens??"";c.font="600 52px 'Fraunces', serif",c.fillStyle=e;let s=j.title??`Steering sweep - coeff = ${o}  (layer ${p})`;c.fillText(s,70,40),c.font=d,c.fillStyle="#4a4d50";let t=j.subtitle??`Prompt: "${q}"   |  Tokens: up to ${r}   |  Color = Delta logprob (steered - base)`;c.fillText(t,70,110),c.font="34px 'Space Grotesk', sans-serif";let u=70,v=180,w=a.generated_pieces||[],x=a.delta_logprobs||[];for(let a=0;a<w.length;a+=1){let b=w[a],d=x[a]??0,e=String(b).split("\n");for(let a=0;a<e.length;a+=1){let b=e[a];if(b){let a=c.measureText(b).width;u+a+12>n&&(u=70,v+=44);let e=f(d,h,i);c.fillStyle=e.css,c.fillRect(u-6,v-4,a+12,42),c.fillStyle=.2126*e.r+.7152*e.g+.0722*e.b<140?"#ffffff":"#1a1a1a",c.fillText(b,u,v),u+=a+12+2}a<e.length-1&&(u=70,v+=44)}if(v>m-120)break}let y=m-80;c.font=d,c.fillStyle=e;let z=j.legendLeft??"Less likely",A=j.legendRight??"More likely";c.fillText(z,70,y-40),c.fillText(A,l-70-250,y-40);let B=l-70-70;for(let a=0;a<B;a+=1)c.strokeStyle=f(h+a/Math.max(B-1,1)*(i-h),h,i).css,c.beginPath(),c.moveTo(70+a,y),c.lineTo(70+a,y+18),c.stroke()},[a,g,h,i,j]),(0,b.jsx)("div",{className:"canvas-wrap",children:(0,b.jsx)("canvas",{ref:k,width:"1920",height:"520"})})}function i({series:a,markerX:d}){let e=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let b=e.current;if(!b)return;let c=b.getContext("2d");if(!c)return;let f=b.width,g=b.height;c.clearRect(0,0,f,g),c.fillStyle="#ffffff",c.fillRect(0,0,f,g);let h=f-48-18,i=g-24-30,j=a.flatMap(a=>a.points);if(!j.length){c.fillStyle="#888",c.font="14px 'Space Grotesk', sans-serif",c.fillText("No data",48,34);return}let k=Math.min(...j.map(a=>a.x)),l=Math.max(...j.map(a=>a.x)),m=Math.min(...j.map(a=>a.y)),n=Math.max(...j.map(a=>a.y));k===l&&(k-=1,l+=1),m===n&&(m-=1,n+=1);let o=(n-m)*.08;m-=o,n+=o;let p=a=>48+(a-k)/(l-k)*h,q=a=>24+(1-(a-m)/(n-m))*i;c.strokeStyle="rgba(0,0,0,0.06)",c.lineWidth=1;for(let a=0;a<=4;a+=1){let b=24+i/4*a;c.beginPath(),c.moveTo(48,b),c.lineTo(48+h,b),c.stroke()}if(c.strokeStyle="rgba(0,0,0,0.2)",c.lineWidth=1.5,c.beginPath(),c.moveTo(48,24),c.lineTo(48,24+i),c.lineTo(48+h,24+i),c.stroke(),a.forEach(a=>{c.strokeStyle=a.color,c.lineWidth=a.dash?2.5:3,a.dash&&c.setLineDash(a.dash),c.beginPath(),a.points.forEach((a,b)=>{let d=p(a.x),e=q(a.y);0===b?c.moveTo(d,e):c.lineTo(d,e)}),c.stroke(),a.dash&&c.setLineDash([])}),null!=d&&Number.isFinite(d)){let b=p(d);c.strokeStyle="rgba(213, 106, 53, 0.5)",c.lineWidth=2,c.setLineDash([4,4]),c.beginPath(),c.moveTo(b,24),c.lineTo(b,24+i),c.stroke(),c.setLineDash([]),a.forEach(a=>{let b=a.points.reduce((a,b)=>a?Math.abs(b.x-d)<Math.abs(a.x-d)?b:a:b,null);if(b){let d=p(b.x),e=q(b.y);c.fillStyle="#ffffff",c.beginPath(),c.arc(d,e,6,0,2*Math.PI),c.fill(),c.fillStyle=a.color,c.beginPath(),c.arc(d,e,4.5,0,2*Math.PI),c.fill()}})}c.fillStyle="#666",c.font="11px 'Space Grotesk', monospace",c.textAlign="right",c.fillText(m.toFixed(2),42,24+i-2),c.fillText(n.toFixed(2),42,34),c.textAlign="center",c.fillText(k.toFixed(1),48,g-8),c.fillText(l.toFixed(1),48+h,g-8)},[a,d]),(0,b.jsx)("div",{className:"canvas-wrap",children:(0,b.jsx)("canvas",{ref:e,width:"640",height:"240"})})}function j({data:a,bins:d=50,title:e="Distribution"}){let f=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let b=f.current;if(!b||!a.length)return;let c=b.getContext("2d");if(!c)return;let g=b.width,h=b.height;c.clearRect(0,0,g,h),c.fillStyle="#ffffff",c.fillRect(0,0,g,h);let i=g-60-40,j=h-40-50,k=Math.min(...a),l=Math.max(...a),m=(l-k)/d,n=Array(d).fill(0);a.forEach(a=>{let b=Math.min(Math.floor((a-k)/m),d-1);n[b]++});let o=Math.max(...n);c.fillStyle="#1a1a1a",c.font="600 16px 'Space Grotesk', sans-serif",c.textAlign="center",c.fillText(e,g/2,24),c.strokeStyle="rgba(0,0,0,0.2)",c.lineWidth=2,c.beginPath(),c.moveTo(60,40),c.lineTo(60,40+j),c.lineTo(60+i,40+j),c.stroke(),c.strokeStyle="rgba(0,0,0,0.05)",c.lineWidth=1;for(let a=0;a<=5;a++){let b=40+j/5*a;c.beginPath(),c.moveTo(60,b),c.lineTo(60+i,b),c.stroke()}let p=i/d;n.forEach((a,b)=>{let d=a/o*j,e=60+b*p,f=40+j-d,g=k+(b+.5)*m,h=c.createLinearGradient(e,f,e,40+j);g>=0?(h.addColorStop(0,"#d56a35"),h.addColorStop(1,"#e89a6e"),c.strokeStyle="rgba(213, 106, 53, 0.3)"):(h.addColorStop(0,"#4287f5"),h.addColorStop(1,"#6fa3f7"),c.strokeStyle="rgba(66, 135, 245, 0.3)"),c.fillStyle=h,c.fillRect(e,f,p-1,d),c.strokeRect(e,f,p-1,d)}),c.fillStyle="#4a4d50",c.font="12px 'Space Grotesk', sans-serif",c.textAlign="right",c.textBaseline="middle";for(let a=0;a<=5;a++){let b=40+j/5*a,d=Math.round(o*(1-a/5));c.fillText(String(d),52,b)}c.textAlign="center",c.textBaseline="top";for(let a=0;a<=5;a++){let b=60+i/5*a,d=k+(l-k)/5*a;c.fillText(d.toFixed(3),b,40+j+8)}c.fillStyle="#2b2f33",c.font="600 13px 'Space Grotesk', sans-serif",c.textAlign="center",c.fillText("Value",g/2,h-12),c.save(),c.translate(20,h/2),c.rotate(-Math.PI/2),c.fillText("Frequency",0,0),c.restore();let q=a.reduce((a,b)=>a+b,0)/a.length,r=[...a].sort((a,b)=>a-b)[Math.floor(a.length/2)],s=Math.sqrt(a.reduce((a,b)=>a+Math.pow(b-q,2),0)/a.length),t=60+i-150,u=50;c.fillStyle="rgba(255, 255, 255, 0.95)",c.fillRect(t,u,140,90),c.strokeStyle="rgba(0, 0, 0, 0.1)",c.lineWidth=1,c.strokeRect(t,u,140,90),c.fillStyle="#2b2f33",c.font="600 12px 'Space Grotesk', sans-serif",c.textAlign="left",c.textBaseline="top",[`Dimensions: ${a.length}`,`Mean: ${q.toFixed(4)}`,`Median: ${r.toFixed(4)}`,`Std Dev: ${s.toFixed(4)}`,`Range: [${k.toFixed(3)}, ${l.toFixed(3)}]`].forEach((a,b)=>{c.fillText(a,t+8,u+8+16*b)})},[a,d,e]),(0,b.jsx)("div",{className:"canvas-wrap",children:(0,b.jsx)("canvas",{ref:f,width:"960",height:"480"})})}function k({isOpen:a,onClose:d,onSelect:e,currentPrompt:f}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{a&&(j(!0),fetch("/api/prompts").then(a=>a.json()).then(a=>{h(a),j(!1)}).catch(a=>{console.error("Failed to load prompts:",a),j(!1)}))},[a]),a)?(0,b.jsx)("div",{className:"dialog-overlay",onClick:d,children:(0,b.jsxs)("div",{className:"dialog-content",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"dialog-header",children:[(0,b.jsx)("h3",{children:"Select Prompt"}),(0,b.jsx)("button",{className:"dialog-close",onClick:d,children:"✕"})]}),(0,b.jsx)("div",{className:"dialog-body",children:i?(0,b.jsx)("div",{className:"dialog-loading",children:"Loading prompts..."}):(0,b.jsx)("div",{className:"prompt-list",children:g.map(a=>(0,b.jsxs)("div",{className:`prompt-item ${f===a?"active":""}`,onClick:()=>{e(a),d()},children:[(0,b.jsxs)("div",{className:"prompt-item-header",children:[(0,b.jsx)("strong",{children:a.split(/[-_]/).map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}),f===a&&(0,b.jsx)("span",{className:"prompt-item-badge",children:"Active"})]}),(0,b.jsxs)("p",{className:"prompt-item-description",children:["Load experiment data from ",a,"/ folder"]})]},a))})})]})}):null}function l(){let[a,d]=(0,c.useState)({data:null,rows:[],coeffs:[],targets:[],selectedTarget:null,currentIndex:0,vmin:-1,vmax:1,baseline:null,steeringVector:null,activeTab:"frame"}),[e,f]=(0,c.useState)("Gemma2ForCausalLM"),[l,m]=(0,c.useState)("Waiting for data..."),[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),t=a=>{if(!a||!Array.isArray(a.rows))return void m("Invalid JSON: missing rows");let b=[...a.rows].sort((a,b)=>(a.coeff??0)-(b.coeff??0)),c=b.map(a=>Number(a.coeff??0)),e=Array.isArray(a.targets)?a.targets:[],f=e;if(!e.length){let a=[];b.forEach(b=>{["targets","targets_first_token"].forEach(c=>{let d=b[c];d&&"object"==typeof d&&a.push(...Object.keys(d))})}),f=[...new Set(a)]}let g=a.delta_color_scale||{},h=Number.isFinite(g.vmin_p5)?g.vmin_p5:-1,i=Number.isFinite(g.vmax_p95)?g.vmax_p95:1;if(!Number.isFinite(h)||!Number.isFinite(i)){let a=function(a){let b=[];if(a.forEach(a=>{(a.delta_logprobs||[]).forEach(a=>b.push(a))}),!b.length)return{vmin:-1,vmax:1};b.sort((a,b)=>a-b);let c=b[Math.floor(.05*b.length)],d=b[Math.floor(.95*b.length)],e=Number.isFinite(c)?c:-1,f=Number.isFinite(d)?d:1;return 1e-6>Math.abs(f-e)&&(e-=1,f+=1),{vmin:e,vmax:f}}(b);h=a.vmin,i=a.vmax}d(d=>({...d,data:a,rows:b,coeffs:c,targets:f,selectedTarget:f[0]||null,currentIndex:0,vmin:h,vmax:i})),m(`Loaded ${b.length} rows`)},u=a=>{if(!a||!Array.isArray(a.rows)||!a.rows.length)return;let b=[...a.rows],c=b.find(a=>"plain_prompt"===String(a.label||""))||b.find(a=>!a.system_prompt)||null,e=b.filter(a=>a.system_prompt),f=e[0]||c||null,g=a.delta_color_scale||{},h=Number.isFinite(g.vmin_p5)?g.vmin_p5:-1,i=Number.isFinite(g.vmax_p95)?g.vmax_p95:1,j=f||c;if((null==h||null==i)&&j?.delta_logprobs?.length){let a=function(a){if(!a||!a.length)return{vmin:-1,vmax:1};let b=[...a].sort((a,b)=>a-b),c=b[Math.floor(.05*b.length)],d=b[Math.floor(.95*b.length)],e=Number.isFinite(c)?c:-1,f=Number.isFinite(d)?d:1;return 1e-6>Math.abs(f-e)&&(e-=1,f+=1),{vmin:e,vmax:f}}(j.delta_logprobs);h=a.vmin,i=a.vmax}let k={data:a,rows:b,plainRow:c,systemRows:e,selectedRow:f,vmin:Number.isFinite(h)?h:-1,vmax:Number.isFinite(i)?i:1};d(a=>({...a,baseline:k}));let l=e.length;m(l?`Baseline loaded (${l} system prompt${l>1?"s":""})`:"Baseline loaded (plain prompt)")},v=a=>{d(b=>({...b,activeTab:a}))},w=async a=>{try{m(`Loading ${a}...`);let b=await fetch(`/data/prompts/${a}/steering_run.json`);if(b.ok){let a=await b.json();t(a)}let c=await fetch(`/data/prompts/${a}/prompt_baseline.json`);if(c.ok){let a=await c.json();u(a)}let e=await fetch(`/data/prompts/${a}/steer_vector.json`);if(e.ok){let a=await e.json();d(b=>({...b,steeringVector:a})),a.modelId&&f(a.modelId)}s(a),m(`Loaded ${a}`)}catch(b){m(`Error loading ${a}: ${b.message}`)}};(0,c.useEffect)(()=>{w("default")},[]);let x=a.rows[a.currentIndex]||null,y=x?Number(x.coeff??0):0,z=x?.next_token?.entropy,A=a.selectedTarget,B=A&&x?.targets&&x.targets[A]?x.targets[A].logprob:null,C=A&&x?.targets_first_token&&x.targets_first_token[A]?x.targets_first_token[A].rank:null,D=A&&x?.targets_first_token&&x.targets_first_token[A]?x.targets_first_token[A].p:null,E=a.rows.filter(a=>a.next_token&&null!=a.next_token.entropy).map(a=>({x:a.coeff??0,y:a.next_token.entropy})),F=[{name:"Entropy",color:"#2c3e50",points:E}];if(n&&a.baseline&&E.length){let b=Math.min(...E.map(a=>a.x)),c=Math.max(...E.map(a=>a.x));if(a.baseline.selectedRow?.next_token?.entropy!=null){let d=a.baseline.selectedRow.next_token.entropy;F.push({name:"System prompt",color:"#d56a35",points:[{x:b,y:d},{x:c,y:d}],dash:[6,6]})}if(a.baseline.plainRow?.next_token?.entropy!=null){let d=a.baseline.plainRow.next_token.entropy;F.push({name:"Plain prompt",color:"#6c8fb6",points:[{x:b,y:d},{x:c,y:d}],dash:[2,6]})}}let G=(A?a.rows.filter(a=>a.targets&&a.targets[A]):[]).map(a=>({x:a.coeff??0,y:a.targets[A].logprob})),H=A?[{name:A,color:"#d56a35",points:G}]:[];if(n&&a.baseline&&G.length&&A){let b=Math.min(...G.map(a=>a.x)),c=Math.max(...G.map(a=>a.x));if(a.baseline.selectedRow?.targets?.[A]){let d=a.baseline.selectedRow.targets[A].logprob;H.push({name:"System prompt",color:"#2c3e50",points:[{x:b,y:d},{x:c,y:d}],dash:[6,6]})}if(a.baseline.plainRow?.targets?.[A]){let d=a.baseline.plainRow.targets[A].logprob;H.push({name:"Plain prompt",color:"#6c8fb6",points:[{x:b,y:d},{x:c,y:d}],dash:[2,6]})}}let I=a.rows[a.currentIndex]?.coeff??null;return(0,b.jsxs)("div",{className:"viewer-container",children:[(0,b.jsxs)("header",{className:"viewer-header",children:[(0,b.jsxs)("div",{className:"header-flow",children:[(0,b.jsxs)("div",{className:"header-item",children:[(0,b.jsx)("label",{className:"header-label",children:"Model"}),(0,b.jsxs)("select",{className:"header-select",value:e,onChange:a=>f(a.target.value),children:[(0,b.jsx)("option",{value:"Gemma2ForCausalLM",children:"Gemma2ForCausalLM"}),(0,b.jsx)("option",{value:"Gemma2-9B-IT",children:"Gemma2-9B-IT"}),(0,b.jsx)("option",{value:"Gemma2-27B-IT",children:"Gemma2-27B-IT"})]})]}),(0,b.jsx)("div",{className:"header-arrow",children:"→"}),(0,b.jsxs)("div",{className:"header-item",children:[(0,b.jsx)("label",{className:"header-label",children:"Steering"}),(0,b.jsxs)("div",{className:"header-value",children:["Layer ",a.data?.layer??"N"," / ",42," | ",a.data?.max_new_tokens??"--"," tokens"]})]}),(0,b.jsx)("div",{className:"header-arrow",children:"→"}),(0,b.jsxs)("div",{className:"header-item header-prompt",onClick:()=>q(!0),children:[(0,b.jsx)("label",{className:"header-label",children:"Prompt"}),(0,b.jsx)("div",{className:"header-value header-clickable",children:a.data?.prompt||a.baseline?.data?.prompt||"No prompt loaded"})]}),(0,b.jsxs)("label",{className:"btn-load",children:[(0,b.jsx)("input",{type:"file",accept:".json",multiple:!0,onChange:a=>{(a.target.files?Array.from(a.target.files):[]).forEach(a=>{let b=new FileReader;b.onload=()=>{try{var c;let d;c=JSON.parse(b.result),d=(a.name||"").toLowerCase(),c?.run_type==="prompt_baseline"||d.includes("baseline")||Array.isArray(c?.rows)&&1===c.rows.length&&!c.delta_color_scale?u(c):t(c)}catch(a){m(`Invalid JSON: ${a.message}`)}},b.readAsText(a)})},style:{display:"none"}}),"Load Data"]})]}),(0,b.jsx)("div",{className:"header-status",children:l})]}),(0,b.jsxs)("main",{className:"viewer-layout",children:[(0,b.jsxs)("section",{className:"viewer-panel viewer-main",children:[(0,b.jsxs)("div",{className:"panel-header",children:[(0,b.jsxs)("div",{className:"panel-tabs",children:[(0,b.jsx)("button",{className:`tab ${"frame"===a.activeTab?"active":""}`,onClick:()=>v("frame"),children:"Steering Sweep"}),(0,b.jsx)("button",{className:`tab ${"prompt"===a.activeTab?"active":""}`,onClick:()=>v("prompt"),children:"Instructions"}),(0,b.jsx)("button",{className:`tab ${"vector"===a.activeTab?"active":""}`,onClick:()=>v("vector"),children:"Vector"}),(0,b.jsx)("button",{className:`tab ${"arch"===a.activeTab?"active":""}`,onClick:()=>v("arch"),children:"Architecture"})]}),"frame"===a.activeTab&&(0,b.jsxs)("div",{className:"panel-stats",children:[(0,b.jsxs)("div",{className:"stat",children:[(0,b.jsx)("span",{className:"stat-label",children:"Coeff"}),(0,b.jsx)("span",{className:"stat-value",children:y.toFixed(1)})]}),(0,b.jsxs)("div",{className:"stat",children:[(0,b.jsx)("span",{className:"stat-label",children:"Entropy"}),(0,b.jsx)("span",{className:"stat-value",children:null!=z?z.toFixed(3):"--"})]}),(0,b.jsxs)("div",{className:"stat",children:[(0,b.jsx)("span",{className:"stat-label",children:"Logprob"}),(0,b.jsx)("span",{className:"stat-value",children:null!=B?B.toFixed(3):"--"})]})]})]}),(0,b.jsxs)("div",{className:"panel-content",children:["frame"===a.activeTab&&x&&(0,b.jsxs)("div",{className:"frame-view",children:[(0,b.jsx)(h,{row:x,data:a.data,vmin:a.vmin,vmax:a.vmax}),(0,b.jsxs)("div",{className:"frame-controls",children:[(0,b.jsx)("input",{type:"range",min:"0",max:Math.max(a.rows.length-1,0),value:a.currentIndex,step:"1",onChange:a=>{let b=Number(a.target.value||0);d(a=>({...a,currentIndex:Math.max(0,Math.min(b,a.rows.length-1))}))},className:"coeff-slider"}),(0,b.jsxs)("div",{className:"slider-info",children:[(0,b.jsxs)("span",{children:["Coefficient: ",y.toFixed(1)]}),(0,b.jsxs)("span",{children:["Frame ",a.currentIndex+1," / ",a.rows.length]})]})]})]}),"prompt"===a.activeTab&&(0,b.jsx)("div",{className:"prompt-view",children:a.baseline&&a.baseline.systemRows.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"instruction-selector",children:[(0,b.jsx)("label",{children:"Select Instruction:"}),(0,b.jsx)("select",{className:"instruction-select",onChange:b=>{if(!a.baseline||!a.baseline.systemRows?.length)return;let c=Number(b.target.value||0),e=a.baseline.systemRows[c]||a.baseline.systemRows[0];d(a=>({...a,baseline:a.baseline?{...a.baseline,selectedRow:e}:null}))},value:a.baseline.systemRows.findIndex(b=>b===a.baseline?.selectedRow),children:a.baseline.systemRows.map((a,c)=>(0,b.jsx)("option",{value:c,children:g(a)},c))})]}),(0,b.jsx)(h,{row:a.baseline.selectedRow,data:a.baseline.data,vmin:a.baseline.vmin,vmax:a.baseline.vmax,options:{title:`Instruction: ${g(a.baseline.selectedRow)}`,subtitle:`Δ logprob (instruction - plain) | Max tokens: ${a.baseline.data?.max_new_tokens??a.data?.max_new_tokens??""}`,legendLeft:"Less likely",legendRight:"More likely"}})]}):(0,b.jsxs)("div",{className:"empty-state",children:[(0,b.jsx)("p",{children:"No instruction data loaded"}),(0,b.jsx)("p",{className:"empty-hint",children:"Upload a baseline JSON file to compare different instructions"})]})}),"vector"===a.activeTab&&(0,b.jsx)("div",{className:"vector-view",children:a.steeringVector?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"vector-meta",children:[(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Layer:"})," ",a.steeringVector.layer]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Feature:"})," ",a.steeringVector.index]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Dimensions:"})," ",a.steeringVector.vector.length]})]}),(0,b.jsx)(j,{data:a.steeringVector.vector,bins:60,title:"Value Distribution"})]}):(0,b.jsx)("div",{className:"empty-state",children:(0,b.jsx)("p",{children:"No steering vector loaded"})})}),"arch"===a.activeTab&&(0,b.jsxs)("div",{className:"arch-view",children:[(0,b.jsxs)("div",{className:"arch-header-section",children:[(0,b.jsx)("h3",{children:"Gemma2ForCausalLM Architecture"}),(0,b.jsxs)("div",{className:"arch-meta-grid",children:[(0,b.jsxs)("div",{className:"arch-meta-item",children:[(0,b.jsx)("span",{className:"arch-meta-label",children:"Model"}),(0,b.jsx)("span",{className:"arch-meta-value",children:e})]}),(0,b.jsxs)("div",{className:"arch-meta-item",children:[(0,b.jsx)("span",{className:"arch-meta-label",children:"Total Layers"}),(0,b.jsx)("span",{className:"arch-meta-value",children:42})]}),(0,b.jsxs)("div",{className:"arch-meta-item",children:[(0,b.jsx)("span",{className:"arch-meta-label",children:"Hidden Size"}),(0,b.jsx)("span",{className:"arch-meta-value",children:"3584"})]}),(0,b.jsxs)("div",{className:"arch-meta-item",children:[(0,b.jsx)("span",{className:"arch-meta-label",children:"Vocab Size"}),(0,b.jsx)("span",{className:"arch-meta-value",children:"256K"})]})]})]}),(0,b.jsx)("div",{className:"arch-flow-container",children:(0,b.jsxs)("div",{className:"arch-flow",children:[(0,b.jsxs)("div",{className:"arch-component-card",children:[(0,b.jsx)("strong",{children:"Token Embedding"}),(0,b.jsx)("span",{className:"arch-detail",children:"256K vocab → 3584 dimensions"})]}),(0,b.jsx)("div",{className:"arch-flow-arrow-large",children:"↓"}),(0,b.jsxs)("div",{className:"arch-decoder-stack",children:[(0,b.jsx)("div",{className:"arch-decoder-title",children:"Transformer Decoder Stack"}),(0,b.jsxs)("div",{className:"arch-active-layer",children:[(0,b.jsxs)("div",{className:"arch-layer-title",children:[(0,b.jsxs)("strong",{children:["Layer ",a.data?.layer??"N"," of 42"]}),a.data?.layer!=null&&(0,b.jsxs)("div",{className:"arch-steering-indicator",children:[(0,b.jsx)("span",{children:"⚡"}),(0,b.jsx)("span",{children:"Steering Injection Point"})]})]}),(0,b.jsxs)("div",{className:"arch-layer-components",children:[(0,b.jsxs)("div",{className:"arch-component-box",children:[(0,b.jsx)("div",{className:"box-title",children:"Multi-Head Attention"}),(0,b.jsxs)("div",{className:"box-details",children:[(0,b.jsx)("div",{children:"• input_layernorm: RMSNorm(3584)"}),(0,b.jsx)("div",{children:"• Q projection: 3584 → 4096"}),(0,b.jsx)("div",{children:"• K projection: 3584 → 2048"}),(0,b.jsx)("div",{children:"• V projection: 3584 → 2048"}),(0,b.jsx)("div",{children:"• output_proj: 4096 → 3584"}),(0,b.jsx)("div",{children:"• post_attention_layernorm"})]})]}),(0,b.jsxs)("div",{className:"arch-component-box",children:[(0,b.jsx)("div",{className:"box-title",children:"Feed-Forward Network"}),(0,b.jsxs)("div",{className:"box-details",children:[(0,b.jsx)("div",{children:"• pre_feedforward_layernorm"}),(0,b.jsx)("div",{children:"• gate projection: 3584 → 14336"}),(0,b.jsx)("div",{children:"• up projection: 3584 → 14336"}),(0,b.jsx)("div",{children:"• GELU activation"}),(0,b.jsx)("div",{children:"• down projection: 14336 → 3584"}),(0,b.jsx)("div",{children:"• post_feedforward_layernorm"})]})]})]})]}),(0,b.jsx)("div",{className:"arch-ellipsis",children:"⋮"})]}),(0,b.jsx)("div",{className:"arch-flow-arrow-large",children:"↓"}),(0,b.jsxs)("div",{className:"arch-component-card",children:[(0,b.jsx)("strong",{children:"Final RMSNorm"}),(0,b.jsx)("span",{className:"arch-detail",children:"3584 dim, eps=1e-06"})]}),(0,b.jsx)("div",{className:"arch-flow-arrow-large",children:"↓"}),(0,b.jsxs)("div",{className:"arch-component-card",children:[(0,b.jsx)("strong",{children:"Language Model Head"}),(0,b.jsx)("span",{className:"arch-detail",children:"3584 → 256K logits"})]})]})})]})]})]}),(0,b.jsxs)("aside",{className:"viewer-panel viewer-sidebar",children:[(0,b.jsxs)("div",{className:"plot-card",children:[(0,b.jsx)("div",{className:"plot-header",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{children:"Entropy Shift"}),(0,b.jsx)("p",{children:"Next-token entropy"})]})}),(0,b.jsx)(i,{series:F,markerX:I})]}),(0,b.jsxs)("div",{className:"plot-card",children:[(0,b.jsxs)("div",{className:"plot-header",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{children:"Target Logprob"}),(0,b.jsx)("p",{children:"Phrase probability"})]}),(0,b.jsx)("select",{onChange:a=>{d(b=>({...b,selectedTarget:a.target.value}))},disabled:!a.targets.length,value:a.selectedTarget||"",className:"target-select",children:0===a.targets.length?(0,b.jsx)("option",{value:"",children:"No targets"}):a.targets.map(a=>(0,b.jsx)("option",{value:a,children:"string"!=typeof a?String(a):a.startsWith(" ")?`[space]${a.slice(1)}`:a},a))})]}),(0,b.jsx)(i,{series:H,markerX:I}),(0,b.jsxs)("div",{className:"plot-footer",children:[(0,b.jsxs)("div",{className:"metric",children:[(0,b.jsx)("span",{className:"metric-label",children:"Rank"}),(0,b.jsx)("span",{className:"metric-value",children:null!=C?C:"--"})]}),(0,b.jsxs)("div",{className:"metric",children:[(0,b.jsx)("span",{className:"metric-label",children:"Prob"}),(0,b.jsx)("span",{className:"metric-value",children:null!=D?D.toFixed(4):"--"})]})]})]}),(0,b.jsx)("div",{className:"baseline-toggle-card",children:(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"checkbox",checked:n,onChange:a=>o(a.target.checked)}),(0,b.jsx)("span",{children:"Show baseline comparison"})]})})]})]}),(0,b.jsx)(k,{isOpen:p,onClose:()=>q(!1),onSelect:w,currentPrompt:r})]})}a.s(["default",()=>l],7884)}];

//# sourceMappingURL=app_viewer_page_tsx_117bf692._.js.map