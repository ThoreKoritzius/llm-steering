(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4355,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let s="28px 'Space Grotesk', sans-serif",l="#1a1a1a";function r(e,t,a){let s={r:247,g:244,b:238};if(a<=t)return{...s,css:`rgb(${s.r},${s.g},${s.b})`};let l=(Math.min(Math.max(e,t),a)-t)/(a-t);if(l<.5){let e=Math.pow((.5-l)/.5,.7),t=Math.round(s.r*(1-e)+42*e),a=Math.round(s.g*(1-e)+97*e),r=Math.round(s.b*(1-e)+216*e);return{r:t,g:a,b:r,css:`rgb(${t},${a},${r})`}}let r=Math.pow((l-.5)/.5,.7),i=Math.round(s.r*(1-r)+217*r),n=Math.round(s.g*(1-r)+67*r),o=Math.round(s.b*(1-r)+58*r);return{r:i,g:n,b:o,css:`rgb(${i},${n},${o})`}}function i(e){return e?e.label?e.label:e.system_prompt?e.system_prompt.replace(/\s+/g," ").trim():"System prompt":"System prompt"}function n({row:e,data:i,vmin:n,vmax:o,options:c={}}){let d=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let t=d.current;if(!t)return;let a=t.getContext("2d");if(!a)return;let h=t.width,m=t.height;a.clearRect(0,0,h,m),a.fillStyle="#ffffff",a.fillRect(0,0,h,m),a.textBaseline="top";let x=h-70,p=Number(e.coeff??0).toFixed(0),f=c.layer??i?.layer??"",v=c.prompt??i?.prompt??"",g=c.maxTokens??i?.max_new_tokens??"";a.font="600 52px 'Fraunces', serif",a.fillStyle=l;let u=c.title??`Steering sweep - coeff = ${p}  (layer ${f})`;a.fillText(u,70,40),a.font=s,a.fillStyle="#4a4d50";let j=c.subtitle??`Prompt: "${v}"   |  Tokens: up to ${g}   |  Color = Delta logprob (steered - base)`;a.fillText(j,70,110),a.font="34px 'Space Grotesk', sans-serif";let b=70,N=180,y=e.generated_pieces||[],w=e.delta_logprobs||[];for(let e=0;e<y.length;e+=1){let t=y[e],s=w[e]??0,l=String(t).split("\n");for(let e=0;e<l.length;e+=1){let t=l[e];if(t){let e=a.measureText(t).width;b+e+12>x&&(b=70,N+=44);let l=r(s,n,o);a.fillStyle=l.css,a.fillRect(b-6,N-4,e+12,42),a.fillStyle=.2126*l.r+.7152*l.g+.0722*l.b<140?"#ffffff":"#1a1a1a",a.fillText(t,b,N),b+=e+12+2}e<l.length-1&&(b=70,N+=44)}if(N>m-120)break}let k=m-80;a.font=s,a.fillStyle=l;let S=c.legendLeft??"Less likely",_=c.legendRight??"More likely";a.fillText(S,70,k-40),a.fillText(_,h-70-250,k-40);let T=h-70-70;for(let e=0;e<T;e+=1)a.strokeStyle=r(n+e/Math.max(T-1,1)*(o-n),n,o).css,a.beginPath(),a.moveTo(70+e,k),a.lineTo(70+e,k+18),a.stroke()},[e,i,n,o,c]),(0,t.jsx)("div",{className:"canvas-wrap",children:(0,t.jsx)("canvas",{ref:d,width:"1920",height:"520"})})}function o({series:e,markerX:s}){let l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let t=l.current;if(!t)return;let a=t.getContext("2d");if(!a)return;let r=t.width,i=t.height;a.clearRect(0,0,r,i),a.fillStyle="#ffffff",a.fillRect(0,0,r,i);let n=r-48-18,o=i-24-30,c=e.flatMap(e=>e.points);if(!c.length){a.fillStyle="#888",a.font="14px 'Space Grotesk', sans-serif",a.fillText("No data",48,34);return}let d=Math.min(...c.map(e=>e.x)),h=Math.max(...c.map(e=>e.x)),m=Math.min(...c.map(e=>e.y)),x=Math.max(...c.map(e=>e.y));d===h&&(d-=1,h+=1),m===x&&(m-=1,x+=1);let p=(x-m)*.08;m-=p,x+=p;let f=e=>48+(e-d)/(h-d)*n,v=e=>24+(1-(e-m)/(x-m))*o;a.strokeStyle="rgba(0,0,0,0.06)",a.lineWidth=1;for(let e=0;e<=4;e+=1){let t=24+o/4*e;a.beginPath(),a.moveTo(48,t),a.lineTo(48+n,t),a.stroke()}if(a.strokeStyle="rgba(0,0,0,0.2)",a.lineWidth=1.5,a.beginPath(),a.moveTo(48,24),a.lineTo(48,24+o),a.lineTo(48+n,24+o),a.stroke(),e.forEach(e=>{a.strokeStyle=e.color,a.lineWidth=e.dash?2.5:3,e.dash&&a.setLineDash(e.dash),a.beginPath(),e.points.forEach((e,t)=>{let s=f(e.x),l=v(e.y);0===t?a.moveTo(s,l):a.lineTo(s,l)}),a.stroke(),e.dash&&a.setLineDash([])}),null!=s&&Number.isFinite(s)){let t=f(s);a.strokeStyle="rgba(213, 106, 53, 0.5)",a.lineWidth=2,a.setLineDash([4,4]),a.beginPath(),a.moveTo(t,24),a.lineTo(t,24+o),a.stroke(),a.setLineDash([]),e.forEach(e=>{let t=e.points.reduce((e,t)=>e?Math.abs(t.x-s)<Math.abs(e.x-s)?t:e:t,null);if(t){let s=f(t.x),l=v(t.y);a.fillStyle="#ffffff",a.beginPath(),a.arc(s,l,6,0,2*Math.PI),a.fill(),a.fillStyle=e.color,a.beginPath(),a.arc(s,l,4.5,0,2*Math.PI),a.fill()}})}a.fillStyle="#666",a.font="11px 'Space Grotesk', monospace",a.textAlign="right",a.fillText(m.toFixed(2),42,24+o-2),a.fillText(x.toFixed(2),42,34),a.textAlign="center",a.fillText(d.toFixed(1),48,i-8),a.fillText(h.toFixed(1),48+n,i-8)},[e,s]),(0,t.jsx)("div",{className:"canvas-wrap",children:(0,t.jsx)("canvas",{ref:l,width:"640",height:"240"})})}function c({data:e,bins:s=50,title:l="Distribution"}){let r=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let t=r.current;if(!t||!e.length)return;let a=t.getContext("2d");if(!a)return;let i=t.width,n=t.height;a.clearRect(0,0,i,n),a.fillStyle="#ffffff",a.fillRect(0,0,i,n);let o=i-60-40,c=n-40-50,d=Math.min(...e),h=Math.max(...e),m=(h-d)/s,x=Array(s).fill(0);e.forEach(e=>{let t=Math.min(Math.floor((e-d)/m),s-1);x[t]++});let p=Math.max(...x);a.fillStyle="#1a1a1a",a.font="600 16px 'Space Grotesk', sans-serif",a.textAlign="center",a.fillText(l,i/2,24),a.strokeStyle="rgba(0,0,0,0.2)",a.lineWidth=2,a.beginPath(),a.moveTo(60,40),a.lineTo(60,40+c),a.lineTo(60+o,40+c),a.stroke(),a.strokeStyle="rgba(0,0,0,0.05)",a.lineWidth=1;for(let e=0;e<=5;e++){let t=40+c/5*e;a.beginPath(),a.moveTo(60,t),a.lineTo(60+o,t),a.stroke()}let f=o/s;x.forEach((e,t)=>{let s=e/p*c,l=60+t*f,r=40+c-s,i=d+(t+.5)*m,n=a.createLinearGradient(l,r,l,40+c);i>=0?(n.addColorStop(0,"#d56a35"),n.addColorStop(1,"#e89a6e"),a.strokeStyle="rgba(213, 106, 53, 0.3)"):(n.addColorStop(0,"#4287f5"),n.addColorStop(1,"#6fa3f7"),a.strokeStyle="rgba(66, 135, 245, 0.3)"),a.fillStyle=n,a.fillRect(l,r,f-1,s),a.strokeRect(l,r,f-1,s)}),a.fillStyle="#4a4d50",a.font="12px 'Space Grotesk', sans-serif",a.textAlign="right",a.textBaseline="middle";for(let e=0;e<=5;e++){let t=40+c/5*e,s=Math.round(p*(1-e/5));a.fillText(String(s),52,t)}a.textAlign="center",a.textBaseline="top";for(let e=0;e<=5;e++){let t=60+o/5*e,s=d+(h-d)/5*e;a.fillText(s.toFixed(3),t,40+c+8)}a.fillStyle="#2b2f33",a.font="600 13px 'Space Grotesk', sans-serif",a.textAlign="center",a.fillText("Value",i/2,n-12),a.save(),a.translate(20,n/2),a.rotate(-Math.PI/2),a.fillText("Frequency",0,0),a.restore();let v=e.reduce((e,t)=>e+t,0)/e.length,g=[...e].sort((e,t)=>e-t)[Math.floor(e.length/2)],u=Math.sqrt(e.reduce((e,t)=>e+Math.pow(t-v,2),0)/e.length),j=60+o-150,b=50;a.fillStyle="rgba(255, 255, 255, 0.95)",a.fillRect(j,b,140,90),a.strokeStyle="rgba(0, 0, 0, 0.1)",a.lineWidth=1,a.strokeRect(j,b,140,90),a.fillStyle="#2b2f33",a.font="600 12px 'Space Grotesk', sans-serif",a.textAlign="left",a.textBaseline="top",[`Dimensions: ${e.length}`,`Mean: ${v.toFixed(4)}`,`Median: ${g.toFixed(4)}`,`Std Dev: ${u.toFixed(4)}`,`Range: [${d.toFixed(3)}, ${h.toFixed(3)}]`].forEach((e,t)=>{a.fillText(e,j+8,b+8+16*t)})},[e,s,l]),(0,t.jsx)("div",{className:"canvas-wrap",children:(0,t.jsx)("canvas",{ref:r,width:"960",height:"480"})})}function d({isOpen:e,onClose:s,onSelect:l,currentPrompt:r}){let[i,n]=(0,a.useState)([]),[o,c]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{e&&(c(!0),fetch("/api/prompts").then(e=>e.json()).then(e=>{n(e),c(!1)}).catch(e=>{console.error("Failed to load prompts:",e),c(!1)}))},[e]),e)?(0,t.jsx)("div",{className:"dialog-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"dialog-content",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"dialog-header",children:[(0,t.jsx)("h3",{children:"Select Prompt"}),(0,t.jsx)("button",{className:"dialog-close",onClick:s,children:"✕"})]}),(0,t.jsx)("div",{className:"dialog-body",children:o?(0,t.jsx)("div",{className:"dialog-loading",children:"Loading prompts..."}):(0,t.jsx)("div",{className:"prompt-list",children:i.map(e=>(0,t.jsxs)("div",{className:`prompt-item ${r===e?"active":""}`,onClick:()=>{l(e),s()},children:[(0,t.jsxs)("div",{className:"prompt-item-header",children:[(0,t.jsx)("strong",{children:e.split(/[-_]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),r===e&&(0,t.jsx)("span",{className:"prompt-item-badge",children:"Active"})]}),(0,t.jsxs)("p",{className:"prompt-item-description",children:["Load experiment data from ",e,"/ folder"]})]},e))})})]})}):null}function h(){let[e,s]=(0,a.useState)({data:null,rows:[],coeffs:[],targets:[],selectedTarget:null,currentIndex:0,vmin:-1,vmax:1,baseline:null,steeringVector:null,activeTab:"frame"}),[l,r]=(0,a.useState)("Gemma2ForCausalLM"),[h,m]=(0,a.useState)("Waiting for data..."),[x,p]=(0,a.useState)(!0),[f,v]=(0,a.useState)(!1),[g,u]=(0,a.useState)(null),j=e=>{if(!e||!Array.isArray(e.rows))return void m("Invalid JSON: missing rows");let t=[...e.rows].sort((e,t)=>(e.coeff??0)-(t.coeff??0)),a=t.map(e=>Number(e.coeff??0)),l=Array.isArray(e.targets)?e.targets:[],r=l;if(!l.length){let e=[];t.forEach(t=>{["targets","targets_first_token"].forEach(a=>{let s=t[a];s&&"object"==typeof s&&e.push(...Object.keys(s))})}),r=[...new Set(e)]}let i=e.delta_color_scale||{},n=Number.isFinite(i.vmin_p5)?i.vmin_p5:-1,o=Number.isFinite(i.vmax_p95)?i.vmax_p95:1;if(!Number.isFinite(n)||!Number.isFinite(o)){let e=function(e){let t=[];if(e.forEach(e=>{(e.delta_logprobs||[]).forEach(e=>t.push(e))}),!t.length)return{vmin:-1,vmax:1};t.sort((e,t)=>e-t);let a=t[Math.floor(.05*t.length)],s=t[Math.floor(.95*t.length)],l=Number.isFinite(a)?a:-1,r=Number.isFinite(s)?s:1;return 1e-6>Math.abs(r-l)&&(l-=1,r+=1),{vmin:l,vmax:r}}(t);n=e.vmin,o=e.vmax}s(s=>({...s,data:e,rows:t,coeffs:a,targets:r,selectedTarget:r[0]||null,currentIndex:0,vmin:n,vmax:o})),m(`Loaded ${t.length} rows`)},b=e=>{if(!e||!Array.isArray(e.rows)||!e.rows.length)return;let t=[...e.rows],a=t.find(e=>"plain_prompt"===String(e.label||""))||t.find(e=>!e.system_prompt)||null,l=t.filter(e=>e.system_prompt),r=l[0]||a||null,i=e.delta_color_scale||{},n=Number.isFinite(i.vmin_p5)?i.vmin_p5:-1,o=Number.isFinite(i.vmax_p95)?i.vmax_p95:1,c=r||a;if((null==n||null==o)&&c?.delta_logprobs?.length){let e=function(e){if(!e||!e.length)return{vmin:-1,vmax:1};let t=[...e].sort((e,t)=>e-t),a=t[Math.floor(.05*t.length)],s=t[Math.floor(.95*t.length)],l=Number.isFinite(a)?a:-1,r=Number.isFinite(s)?s:1;return 1e-6>Math.abs(r-l)&&(l-=1,r+=1),{vmin:l,vmax:r}}(c.delta_logprobs);n=e.vmin,o=e.vmax}let d={data:e,rows:t,plainRow:a,systemRows:l,selectedRow:r,vmin:Number.isFinite(n)?n:-1,vmax:Number.isFinite(o)?o:1};s(e=>({...e,baseline:d}));let h=l.length;m(h?`Baseline loaded (${h} system prompt${h>1?"s":""})`:"Baseline loaded (plain prompt)")},N=e=>{s(t=>({...t,activeTab:e}))},y=async e=>{try{m(`Loading ${e}...`);let t=await fetch(`/data/prompts/${e}/steering_run.json`);if(t.ok){let e=await t.json();j(e)}let a=await fetch(`/data/prompts/${e}/prompt_baseline.json`);if(a.ok){let e=await a.json();b(e)}let l=await fetch(`/data/prompts/${e}/steer_vector.json`);if(l.ok){let e=await l.json();s(t=>({...t,steeringVector:e})),e.modelId&&r(e.modelId)}u(e),m(`Loaded ${e}`)}catch(t){m(`Error loading ${e}: ${t.message}`)}};(0,a.useEffect)(()=>{y("default")},[]);let w=e.rows[e.currentIndex]||null,k=w?Number(w.coeff??0):0,S=w?.next_token?.entropy,_=e.selectedTarget,T=_&&w?.targets&&w.targets[_]?w.targets[_].logprob:null,M=_&&w?.targets_first_token&&w.targets_first_token[_]?w.targets_first_token[_].rank:null,F=_&&w?.targets_first_token&&w.targets_first_token[_]?w.targets_first_token[_].p:null,R=e.rows.filter(e=>e.next_token&&null!=e.next_token.entropy).map(e=>({x:e.coeff??0,y:e.next_token.entropy})),$=[{name:"Entropy",color:"#2c3e50",points:R}];if(x&&e.baseline&&R.length){let t=Math.min(...R.map(e=>e.x)),a=Math.max(...R.map(e=>e.x));if(e.baseline.selectedRow?.next_token?.entropy!=null){let s=e.baseline.selectedRow.next_token.entropy;$.push({name:"System prompt",color:"#d56a35",points:[{x:t,y:s},{x:a,y:s}],dash:[6,6]})}if(e.baseline.plainRow?.next_token?.entropy!=null){let s=e.baseline.plainRow.next_token.entropy;$.push({name:"Plain prompt",color:"#6c8fb6",points:[{x:t,y:s},{x:a,y:s}],dash:[2,6]})}}let C=(_?e.rows.filter(e=>e.targets&&e.targets[_]):[]).map(e=>({x:e.coeff??0,y:e.targets[_].logprob})),L=_?[{name:_,color:"#d56a35",points:C}]:[];if(x&&e.baseline&&C.length&&_){let t=Math.min(...C.map(e=>e.x)),a=Math.max(...C.map(e=>e.x));if(e.baseline.selectedRow?.targets?.[_]){let s=e.baseline.selectedRow.targets[_].logprob;L.push({name:"System prompt",color:"#2c3e50",points:[{x:t,y:s},{x:a,y:s}],dash:[6,6]})}if(e.baseline.plainRow?.targets?.[_]){let s=e.baseline.plainRow.targets[_].logprob;L.push({name:"Plain prompt",color:"#6c8fb6",points:[{x:t,y:s},{x:a,y:s}],dash:[2,6]})}}let A=e.rows[e.currentIndex]?.coeff??null;return(0,t.jsxs)("div",{className:"viewer-container",children:[(0,t.jsxs)("header",{className:"viewer-header",children:[(0,t.jsxs)("div",{className:"header-flow",children:[(0,t.jsxs)("div",{className:"header-item",children:[(0,t.jsx)("label",{className:"header-label",children:"Model"}),(0,t.jsxs)("select",{className:"header-select",value:l,onChange:e=>r(e.target.value),children:[(0,t.jsx)("option",{value:"Gemma2ForCausalLM",children:"Gemma2ForCausalLM"}),(0,t.jsx)("option",{value:"Gemma2-9B-IT",children:"Gemma2-9B-IT"}),(0,t.jsx)("option",{value:"Gemma2-27B-IT",children:"Gemma2-27B-IT"})]})]}),(0,t.jsx)("div",{className:"header-arrow",children:"→"}),(0,t.jsxs)("div",{className:"header-item",children:[(0,t.jsx)("label",{className:"header-label",children:"Steering"}),(0,t.jsxs)("div",{className:"header-value",children:["Layer ",e.data?.layer??"N"," / ",42," | ",e.data?.max_new_tokens??"--"," tokens"]})]}),(0,t.jsx)("div",{className:"header-arrow",children:"→"}),(0,t.jsxs)("div",{className:"header-item header-prompt",onClick:()=>v(!0),children:[(0,t.jsx)("label",{className:"header-label",children:"Prompt"}),(0,t.jsx)("div",{className:"header-value header-clickable",children:e.data?.prompt||e.baseline?.data?.prompt||"No prompt loaded"})]}),(0,t.jsxs)("label",{className:"btn-load",children:[(0,t.jsx)("input",{type:"file",accept:".json",multiple:!0,onChange:e=>{(e.target.files?Array.from(e.target.files):[]).forEach(e=>{let t=new FileReader;t.onload=()=>{try{var a;let s;a=JSON.parse(t.result),s=(e.name||"").toLowerCase(),a?.run_type==="prompt_baseline"||s.includes("baseline")||Array.isArray(a?.rows)&&1===a.rows.length&&!a.delta_color_scale?b(a):j(a)}catch(e){m(`Invalid JSON: ${e.message}`)}},t.readAsText(e)})},style:{display:"none"}}),"Load Data"]})]}),(0,t.jsx)("div",{className:"header-status",children:h})]}),(0,t.jsxs)("main",{className:"viewer-layout",children:[(0,t.jsxs)("section",{className:"viewer-panel viewer-main",children:[(0,t.jsxs)("div",{className:"panel-header",children:[(0,t.jsxs)("div",{className:"panel-tabs",children:[(0,t.jsx)("button",{className:`tab ${"frame"===e.activeTab?"active":""}`,onClick:()=>N("frame"),children:"Steering Sweep"}),(0,t.jsx)("button",{className:`tab ${"prompt"===e.activeTab?"active":""}`,onClick:()=>N("prompt"),children:"Instructions"}),(0,t.jsx)("button",{className:`tab ${"vector"===e.activeTab?"active":""}`,onClick:()=>N("vector"),children:"Vector"}),(0,t.jsx)("button",{className:`tab ${"arch"===e.activeTab?"active":""}`,onClick:()=>N("arch"),children:"Architecture"})]}),"frame"===e.activeTab&&(0,t.jsxs)("div",{className:"panel-stats",children:[(0,t.jsxs)("div",{className:"stat",children:[(0,t.jsx)("span",{className:"stat-label",children:"Coeff"}),(0,t.jsx)("span",{className:"stat-value",children:k.toFixed(1)})]}),(0,t.jsxs)("div",{className:"stat",children:[(0,t.jsx)("span",{className:"stat-label",children:"Entropy"}),(0,t.jsx)("span",{className:"stat-value",children:null!=S?S.toFixed(3):"--"})]}),(0,t.jsxs)("div",{className:"stat",children:[(0,t.jsx)("span",{className:"stat-label",children:"Logprob"}),(0,t.jsx)("span",{className:"stat-value",children:null!=T?T.toFixed(3):"--"})]})]})]}),(0,t.jsxs)("div",{className:"panel-content",children:["frame"===e.activeTab&&w&&(0,t.jsxs)("div",{className:"frame-view",children:[(0,t.jsx)(n,{row:w,data:e.data,vmin:e.vmin,vmax:e.vmax}),(0,t.jsxs)("div",{className:"frame-controls",children:[(0,t.jsx)("input",{type:"range",min:"0",max:Math.max(e.rows.length-1,0),value:e.currentIndex,step:"1",onChange:e=>{let t=Number(e.target.value||0);s(e=>({...e,currentIndex:Math.max(0,Math.min(t,e.rows.length-1))}))},className:"coeff-slider"}),(0,t.jsxs)("div",{className:"slider-info",children:[(0,t.jsxs)("span",{children:["Coefficient: ",k.toFixed(1)]}),(0,t.jsxs)("span",{children:["Frame ",e.currentIndex+1," / ",e.rows.length]})]})]})]}),"prompt"===e.activeTab&&(0,t.jsx)("div",{className:"prompt-view",children:e.baseline&&e.baseline.systemRows.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"instruction-selector",children:[(0,t.jsx)("label",{children:"Select Instruction:"}),(0,t.jsx)("select",{className:"instruction-select",onChange:t=>{if(!e.baseline||!e.baseline.systemRows?.length)return;let a=Number(t.target.value||0),l=e.baseline.systemRows[a]||e.baseline.systemRows[0];s(e=>({...e,baseline:e.baseline?{...e.baseline,selectedRow:l}:null}))},value:e.baseline.systemRows.findIndex(t=>t===e.baseline?.selectedRow),children:e.baseline.systemRows.map((e,a)=>(0,t.jsx)("option",{value:a,children:i(e)},a))})]}),(0,t.jsx)(n,{row:e.baseline.selectedRow,data:e.baseline.data,vmin:e.baseline.vmin,vmax:e.baseline.vmax,options:{title:`Instruction: ${i(e.baseline.selectedRow)}`,subtitle:`Δ logprob (instruction - plain) | Max tokens: ${e.baseline.data?.max_new_tokens??e.data?.max_new_tokens??""}`,legendLeft:"Less likely",legendRight:"More likely"}})]}):(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("p",{children:"No instruction data loaded"}),(0,t.jsx)("p",{className:"empty-hint",children:"Upload a baseline JSON file to compare different instructions"})]})}),"vector"===e.activeTab&&(0,t.jsx)("div",{className:"vector-view",children:e.steeringVector?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"vector-meta",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Layer:"})," ",e.steeringVector.layer]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Feature:"})," ",e.steeringVector.index]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Dimensions:"})," ",e.steeringVector.vector.length]})]}),(0,t.jsx)(c,{data:e.steeringVector.vector,bins:60,title:"Value Distribution"})]}):(0,t.jsx)("div",{className:"empty-state",children:(0,t.jsx)("p",{children:"No steering vector loaded"})})}),"arch"===e.activeTab&&(0,t.jsxs)("div",{className:"arch-view",children:[(0,t.jsxs)("div",{className:"arch-header-section",children:[(0,t.jsx)("h3",{children:"Gemma2ForCausalLM Architecture"}),(0,t.jsxs)("div",{className:"arch-meta-grid",children:[(0,t.jsxs)("div",{className:"arch-meta-item",children:[(0,t.jsx)("span",{className:"arch-meta-label",children:"Model"}),(0,t.jsx)("span",{className:"arch-meta-value",children:l})]}),(0,t.jsxs)("div",{className:"arch-meta-item",children:[(0,t.jsx)("span",{className:"arch-meta-label",children:"Total Layers"}),(0,t.jsx)("span",{className:"arch-meta-value",children:42})]}),(0,t.jsxs)("div",{className:"arch-meta-item",children:[(0,t.jsx)("span",{className:"arch-meta-label",children:"Hidden Size"}),(0,t.jsx)("span",{className:"arch-meta-value",children:"3584"})]}),(0,t.jsxs)("div",{className:"arch-meta-item",children:[(0,t.jsx)("span",{className:"arch-meta-label",children:"Vocab Size"}),(0,t.jsx)("span",{className:"arch-meta-value",children:"256K"})]})]})]}),(0,t.jsx)("div",{className:"arch-flow-container",children:(0,t.jsxs)("div",{className:"arch-flow",children:[(0,t.jsxs)("div",{className:"arch-component-card",children:[(0,t.jsx)("strong",{children:"Token Embedding"}),(0,t.jsx)("span",{className:"arch-detail",children:"256K vocab → 3584 dimensions"})]}),(0,t.jsx)("div",{className:"arch-flow-arrow-large",children:"↓"}),(0,t.jsxs)("div",{className:"arch-decoder-stack",children:[(0,t.jsx)("div",{className:"arch-decoder-title",children:"Transformer Decoder Stack"}),(0,t.jsxs)("div",{className:"arch-active-layer",children:[(0,t.jsxs)("div",{className:"arch-layer-title",children:[(0,t.jsxs)("strong",{children:["Layer ",e.data?.layer??"N"," of 42"]}),e.data?.layer!=null&&(0,t.jsxs)("div",{className:"arch-steering-indicator",children:[(0,t.jsx)("span",{children:"⚡"}),(0,t.jsx)("span",{children:"Steering Injection Point"})]})]}),(0,t.jsxs)("div",{className:"arch-layer-components",children:[(0,t.jsxs)("div",{className:"arch-component-box",children:[(0,t.jsx)("div",{className:"box-title",children:"Multi-Head Attention"}),(0,t.jsxs)("div",{className:"box-details",children:[(0,t.jsx)("div",{children:"• input_layernorm: RMSNorm(3584)"}),(0,t.jsx)("div",{children:"• Q projection: 3584 → 4096"}),(0,t.jsx)("div",{children:"• K projection: 3584 → 2048"}),(0,t.jsx)("div",{children:"• V projection: 3584 → 2048"}),(0,t.jsx)("div",{children:"• output_proj: 4096 → 3584"}),(0,t.jsx)("div",{children:"• post_attention_layernorm"})]})]}),(0,t.jsxs)("div",{className:"arch-component-box",children:[(0,t.jsx)("div",{className:"box-title",children:"Feed-Forward Network"}),(0,t.jsxs)("div",{className:"box-details",children:[(0,t.jsx)("div",{children:"• pre_feedforward_layernorm"}),(0,t.jsx)("div",{children:"• gate projection: 3584 → 14336"}),(0,t.jsx)("div",{children:"• up projection: 3584 → 14336"}),(0,t.jsx)("div",{children:"• GELU activation"}),(0,t.jsx)("div",{children:"• down projection: 14336 → 3584"}),(0,t.jsx)("div",{children:"• post_feedforward_layernorm"})]})]})]})]}),(0,t.jsx)("div",{className:"arch-ellipsis",children:"⋮"})]}),(0,t.jsx)("div",{className:"arch-flow-arrow-large",children:"↓"}),(0,t.jsxs)("div",{className:"arch-component-card",children:[(0,t.jsx)("strong",{children:"Final RMSNorm"}),(0,t.jsx)("span",{className:"arch-detail",children:"3584 dim, eps=1e-06"})]}),(0,t.jsx)("div",{className:"arch-flow-arrow-large",children:"↓"}),(0,t.jsxs)("div",{className:"arch-component-card",children:[(0,t.jsx)("strong",{children:"Language Model Head"}),(0,t.jsx)("span",{className:"arch-detail",children:"3584 → 256K logits"})]})]})})]})]})]}),(0,t.jsxs)("aside",{className:"viewer-panel viewer-sidebar",children:[(0,t.jsxs)("div",{className:"plot-card",children:[(0,t.jsx)("div",{className:"plot-header",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{children:"Entropy Shift"}),(0,t.jsx)("p",{children:"Next-token entropy"})]})}),(0,t.jsx)(o,{series:$,markerX:A})]}),(0,t.jsxs)("div",{className:"plot-card",children:[(0,t.jsxs)("div",{className:"plot-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{children:"Target Logprob"}),(0,t.jsx)("p",{children:"Phrase probability"})]}),(0,t.jsx)("select",{onChange:e=>{s(t=>({...t,selectedTarget:e.target.value}))},disabled:!e.targets.length,value:e.selectedTarget||"",className:"target-select",children:0===e.targets.length?(0,t.jsx)("option",{value:"",children:"No targets"}):e.targets.map(e=>(0,t.jsx)("option",{value:e,children:"string"!=typeof e?String(e):e.startsWith(" ")?`[space]${e.slice(1)}`:e},e))})]}),(0,t.jsx)(o,{series:L,markerX:A}),(0,t.jsxs)("div",{className:"plot-footer",children:[(0,t.jsxs)("div",{className:"metric",children:[(0,t.jsx)("span",{className:"metric-label",children:"Rank"}),(0,t.jsx)("span",{className:"metric-value",children:null!=M?M:"--"})]}),(0,t.jsxs)("div",{className:"metric",children:[(0,t.jsx)("span",{className:"metric-label",children:"Prob"}),(0,t.jsx)("span",{className:"metric-value",children:null!=F?F.toFixed(4):"--"})]})]})]}),(0,t.jsx)("div",{className:"baseline-toggle-card",children:(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:x,onChange:e=>p(e.target.checked)}),(0,t.jsx)("span",{children:"Show baseline comparison"})]})})]})]}),(0,t.jsx)(d,{isOpen:f,onClose:()=>v(!1),onSelect:y,currentPrompt:g})]})}e.s(["default",()=>h],4355)}]);